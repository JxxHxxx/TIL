
- 일반적으로 데이터베이스 서버 입장에서는 WAS 가 클라이언트가 된다. 물론 `dbeaver` 같은 DB 접근 툴도 클라이언트가 될 수 있다. 

- WAS에서 데이터베이스 서버에 연결을 요청하고 커넥션을 맺게 된다. 좀 더 자세히 말하면 WAS, 데이터베이스 모두 커넥션을 가지고 있는데 서로 연결을 맺는 것이다.

- WAS 에서는 `HikariCP` 같은 곳에 커넥션이 보관되어 있다. 데이터베이스에서도 MySQL 기준 `SHOW VARIABLES LIKE '%max_connection%';` 를 통해 현재 커넥션 개수를 확인할 수 있다.

*`SHOW VARIABLES LIKE '%max_connection%'`* 
   
![[Pasted image 20231003200350.png]](../images/Pasted%20image%2020231003200350.png)


-  커넥션을 맺게 되면 DB 내부에 세션이 생성된다. 세션은 트랜잭션을 시작하고 커밋 또는 롤백을 통해 트랜잭션을 종료한다. 그리고 이후에 새로운 트랜잭션을 다시 시작할 수 있다.

*`SHOW PROCESSLIST`*

![[Pasted image 20231003200635.png]](../images/Pasted%20image%2020231003200635.png)


여기서부턴 삽질해보면서 터득한 내용이다.

- DB 세션은 **최초 커넥션을 맺었을 때** 애플리케이션 서버에서 설정한 `MaxPoolSize` 만큼 생성된다. 하지만 데이터베이스 서버의 `max_connections` 수를 초과할 수는 없다. 당연하게도 ㅎㅎ

-  커넥션과 세션은 다른 개념이다. 세션은 최초 커넥션을 맺은 이후 일반적으로 지속적으로 활성화 되어 있다. 
- 반면 커넥션은 WAS, DB 모두 요청, 응답이 필요할 때만 활성화되고 이후에는 `close` 된다.
