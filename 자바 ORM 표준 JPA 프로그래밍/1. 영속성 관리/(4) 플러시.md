
플러시(`flush()`)는 영속성 컨텍스트의 변경 내용을 데이터베이스에 반영한다.  반영이라고 표현하지만 실제도 데이터베이스에 변경된 내역이 `commit`되는건 아니다.

플러시를 실행하면 다음과 같은 일이 일어난다.

1. 변경 감지가 동작해서 영속성 컨텍스트에 있는 모든 엔티티를 스냅샷과 비교해서 수정된 엔티티를 찾는다. 수정된 엔티티는 수정 쿼리를 만들어 쓰기 지연 SQL 저장소에 등록한다.
2. 쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송한다. (등록, 수정, 삭제 쿼리)


##### 영속성 컨텍스트를 플러시하는 방법 3가지

1. `em.flush()` 직접 호출
2. 트랜잭션 커밋 시 플러시 자동 호출
3. JPQL 쿼리 실행 시 플러시 자동 호출

-  *트랜잭션 커밋 시 플러시 자동 호출*

변경 내용을 `flush()` 하지 않으면 데이터베이스에 어떤 내용도 반영되지 않는다. 따라서 트랜잭션을 커밋하기 전에 플러시를 호출해서 영속성 컨텍스트 변경 내용을 데이터베이스에 반영해야 한다. 이런 문제를 예방하기 위해 커밋 시 플러시를 자동 호출한다. 

-  *JPQL 쿼리 실행 시 플러시 자동 호출*

JPQL은 SQL로 변환되어 데이터베이스에서 엔티티를 조회하게 된다. 이 말을 다르게 보면 영속성 컨텍스트를 거치지 않고 데이터베이스를 조회한다는 것이다. 그렇기 때문에 만약 영속성 컨텍스트의 변경 내역이 있다면 해당 내용이 반영되지 않을 수 있다. 이 문제를 예방하기 위해 JPQL을 실행할 때도 플러시를 자동 호출한다.
참고로 식별자를 기준으로 조회하는 `find()` 메서드를 호출할 때는 플러시가 실행되지 않는다.