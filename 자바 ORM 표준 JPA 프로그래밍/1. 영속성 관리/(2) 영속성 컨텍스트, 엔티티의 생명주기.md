
### 영속성 컨텍스트란?

영속성 컨텍스트(`persistence context`)란 엔티티를 영구 저장하는 환경이다. 

이해를 위해 다르게 말하면 영속성 컨텍스트에 저장되었다고 데이터베이스에 저장되는 것은 아니다. 둘은 다른 공간이다.

일반적으로 엔티티 매니저 1개 마다 영속성 컨텍스트 1개가 만들어진다고 보면 된다. 


### 엔티티의 생명주기

엔티티에는 4가지 상태가 존재한다.

- 비영속
- 영속
- 준영속
- 삭제

중요한 개념이다. 생명주기에 대한 이해가 없으면 변경 감지와 같은 기능이 잘 이해되지 않을 수 있다.


##### 영속
하지만 어렵지는 않다. 우선 엔티티라고 하더라도 생성 시점부터 엔티티 매니저(`EntityManager`)의 관리를 받는 것은 아니다. 관리를 받기 위해서는  영속성 컨텍스트(`Persistence Context`)에 들어와야하고 그것을 영속 상태라고 한다. `persist()` 를 통해 엔티티를 영속 상태로 만들 수 있다.

```
Member member = new Member(100L, "jxx"); // 비영속
entityManager.persist(member); // 영속
```


##### 비영속
영속 상태를 이해했다면 어느정도 비영속 상태가 무엇인지 감을 잡을 수 있다. 비영속 상태는 영속성 컨텍스트와 **전혀 관계가 없는 상태**이다.  


##### 준영속
준영속은 비영속과 유사해 보일 수 있지만 차이가 있다. 영속성 컨텍스트가 관리하던 영속 상태의 엔티티를 영속성 컨텍스트가 관리하지 않으면 준영속 상태이다. 

`detach()` 를 호출하거나 영속성 컨텍스트를 닫거나 초기화해서 영속 상태의 엔티티를 준영속 상태로 만들 수 있다. 

##### 삭제
엔티티를 연속성 컨텍스트와 데이터베이스에서 삭제한다.