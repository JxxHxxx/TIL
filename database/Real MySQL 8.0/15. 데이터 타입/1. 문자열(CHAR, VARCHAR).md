
컬럼 데이터 타입과 길이를 선정할 때 가장 주의할 사항은 다음과 같다

-  저장되는 값의 성격에 맞는 최적의 타입 선정
-  가변 길이 칼럼은 최적의 길이를 지정
-  조인 조건으로 사용되는 컬럼은 똑같은 데이터 타입으로 선정


### 15.1 문자열(CHAR와 VARCHAR)
---

###### 저장 공간

CHAR, VARCHAR 공통점은 문자열을 저장할 수 있는 데이터 타입이다. 가장 큰 차이는 고정 길이, 가변 길이다.


- 고정 길이는 실제 입력되는 컬럼값의 길이에 따라 사용하는 저장 공간의 크기가 변하지 않는다. CHAR 타입은 이미 저장 공간의 크기가 고정적이다. 실제 저아된 값의 요휴 크기가 얼마인지 별도로 저장할 필요가 없으므로 추가로 공간이 필요하지 않다.

- 가변 길이는 최대로 저장할 수 있는 값의 길이는 제한돼 있지만, 그 이하 크기의 값이 저장되면 그만큼 저장 공간이 줄어든다. 하지만 VARCHAR 타입은 저장된 값의 유효 크기가 얼마인지를 별도로 저장해 둬야 하므로 1~2바이트의 공간을 추가로 더 사용한다.
- VARCHAR 타입의 길이가 255바이트 이하면 1바이트만 사용하고, 256바이트 이상으로 설정되면 2바이트를 사용한다. VARCHAR 타입의 최대 길이는 2바이트로 표현할 수 있는 이상은 사용할 수 없다. 즉, VARCHAR 타입의 최대 길이는 65,536 바이트(2의 16제곱, 2바이트) 이상으로 설정할 수 없다.

```
문자열 타입의 저장 공간을 언급할 때는 1문자와 1바이트를 구분해서 사용한다. 1문자는 실제 저장되는 값의 문자 집합에 따라 1~4바이트까지 공간을 사용할 수 있기 때문이다. 실제 저장되는 문자가 아시아권의 언어라면 저장 가능한 글자수는 반으로 줄고, UTF-8 문자를 저장한다면 실제 저장 가능한 글자 수는 1/4로 줄어들 것이다.
```


```
CHAR(10) 은 10개의 문자까지 저장이 가능하다. 
```


문자열 값의 길이가 항상 일정하다면 CHAR를 사용하고 가변적이라면 VARCHAR를 사용하는 것이 일반적이다. 

CHAR, VARCHAR 를 선택하는 기준은 다음과 같다

- 저장되는 문자열의 길이가 대개 비슷한가?
- 컬럼의 값이 자주 변경되는가?

---
##### 저장 방식 비교

###### CHAR

```sql
create table tb_test (
fd1 INT not null,
fd2 CHAR(10) not null,
fd3 DATETIME not null
);

-- 4byte 에 ABCD 저장 빈 공간 6byte
INSERT into tb_test (fd1, fd2, fd3) values (1, 'ABCD', '2011-06-27 11:02:11');
```

###### VARCHAR

```sql
create table tb_test2 (
fd1 INT not null,
fd2 VARCHAR(10) not null,
fd3 DATETIME not null
);

-- 1byte 에 길이 저장 4byte ABCD , 빈 공간 없음
INSERT into tb_test2 (fd1, fd2, fd3) values (1, 'ABCD', '2011-06-27 11:02:11');
```


중요한 건 `fd2` 컬럼이 변경될 때 어떤 현상이 발생하느냐다. `fd2` 컬럼 값을 `ABCDE` 로 변경했다고 가정해보자.

- CHAR(10) 타입을 사용하면 10바이트 공간이 준비돼 있으므로 그냥 변경되는 컬럼의 값을 업데이트만 하면 된다.
- VARCHAR(10) 타입을 사용하는 경우, fd2 컬럼이 4바이트밖에 저장할 수 없는 구조로 만들어져 있다. 그래서 ABCDE 같이 길이가 더 큰 값으로 변경될 때는 레코드 자체를 다른 공간으로 옮겨서(Row migration) 저장해야 한다.


VARCHAR 타입 값 UPDATE 는 레코드의 이동, 분리를 유발한다. 자주 변경된거나 고정적인 길이라면 CHAR 타입을 고려하는게 좋다.
