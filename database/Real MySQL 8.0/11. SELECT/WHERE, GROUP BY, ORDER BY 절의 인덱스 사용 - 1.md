
##### 인덱스를 사용하기 위한 기본 규칙
---
인덱스된 칼럼 값 자체를 변환하지 않고 그대로 사용한다는 조건을 만족해야 한다.
인덱스는 컬럼 값을 아무런 변환 없이 B-Tree에 정렬해서 저장한다.

추가로 `WHERE` 절에 사용되는 비교 조건에서 연산자 양쪽의 두 비교 대상 값은 데이터 타입이 일치해야 한다.

정리
- 인덱스 컬럼 변형 X
-  `WHERE` 비교 절일 경우 양쪽 모두 동일한 데이터 타입


##### WHERE 절의 인덱스 사용
---
단순 `WHERE` 조건만 사용한다면 인덱스에 명시된 컬럼 순서대로 나열하지 않아도 인덱스듣 동작한다.

**OR 조건이 포함된 경우**

```sql
SELECT * FROM employees
WHERE first_name="Kebin" OR last_name="Poly"
```

`first_name` 컬럼에만 인덱스가 걸려있다. 이 경우에는 옵티마이저는 풀 테이블 스캔을 사용할 수밖에 없다. 만약 `last_name` 컬럼도에 인덱스가 있다면 `index_merge` 접근 방법으로 실행할 수 있다. 물론 여전히 레인지 스캔보다는 느리다.

결론적으로, `OR` 조건으로 연결되어 있다면 비교해야 할 레코드가 더 늘어나기 때문에 `OR` 사용 시에는 주의해야 한다.

##### GROUP BY, ORDER BY
---

-  GROUP BY : 인덱스에 명시된 컬럼 순서를 지켜야 한다. 다시 말해 멀티 인덱스가 `A, B, C` 순으로 지정됐다면 `GROUP BY A, B, C` 순으로 작성해야 한다. 순서만 준수하면 되고 중간에 누락되는 것은 상관 없다.
- ORDER BY : `GROUP BY` 에서 추가로 인덱스에서 지정한 XX차순 옵션이 인덱스와 같거나 정반대여야 한다.


##### WHERE 조건과 ORDER BY, GROUP BY 절의 인덱스
---
실무에서는 `WHERE` , `ORDER BY` , `GROUP BY` 를 혼합해서 사용하는 경우가 많다. 이 경우에는 3가지 중 한 가지 방법으로만 인덱스를 이용한다.

- `WHERE` , `ORDER BY` 절이 동시에 같은 인덱스 이용 :  두 절의 비교 조건에 사용되는 컬럼이 모두 하나의 인덱스에 연속해서 포함돼 있을 때 이 방식으로 인덱스를 사용할 수 있다. 가능하다면 이 방식으로 처리할 수 있게 쿼리를 튜닝하거나 인덱스를 생성하는 것이 좋다.

- `WHERE` 절만 인덱스를 이용 : `ORDER BY` 절은 인덱스를 이용한 정렬이 불가능, 인덱스를 통해 검색된 결과 레코드를 별도 정렬 처리 과정을 거쳐 정렬 수행, `WHERE` 절의 조건에 일치하는 레코드 건수가 많지 않을 때 효율적

- `ORDER BY` 절만 인덱스를 이용 : 이 방식은 `ORDER BY` 절의 순서대로 인덱스를 읽으면서 레코드 한 건씩 `WHERE` 절의 조건에 일치하는지 비교, 일치하지 않을 때는 버리는 형태로 처리한다. 주로 아주 많은 레코드를 조회해서 정렬해야 할 때는 이런 형태로 튜닝하기도 한다.


##### WHERE 절의 비교 조건 사용 시 주의사항
---

**NULL 비교**
다른 DBMS와 조금 다르게 MySQL에서는 `NULL` 값이 포함된 레코드도 인덱스로 관리된다. SQL 표준에서는 `NULL` 의 정의는 비교할 수 없는 값이다. 그래서 두 값이 모두 `NULL` 을 가진다고 하더라도 이 두 값이 동등한지 비교하는 것은 불가능하다.

결론적으로 `NULL` 비교를 하려면 `IS NULL` 혹은 `<=>` 연산자를 사용해야 한다. 이 경우에는 인덱스를 정상적으로 탄다.  하지만 다음과 같은 쿼리는 인덱스를 사용하지 못한다. 

```sql
SELECT * FROM titles WHERE ISNULL(to_date)=1;
SELECT ** FROM titles WHERE ISNULL(to_date)=true;
```


**문자열이나 숫자 비교**
문자열 컬럼이나 숫자 컬럼을 비교할 때는 반드시 그 타입에 맞는 상숫값을 사용할 것을 권장한다.

```sql
-- emp_no integer, first_name varchar 타입이라고 할 때 아래 쿼리는 인덱스를 사용할 수 없다.

SELECT * FROM employees WHERE emp_no= '10001';
SELECT * FROM employees WHERE first_name= 10001;
```

